---
import HomeIcon from "./icons/HomeIcon.astro";
import BriefcaseIcon from "./icons/BriefcaseIcon.astro";
import CodeIcon from "./icons/CodeIcon.astro";
import SunIcon from "./icons/SunIcon.astro";
import MoonIcon from "./icons/MoonIcon.astro";
---

<nav class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
  <div
    class="flex items-center gap-1 px-2 py-2 bg-white/80 dark:bg-[#1a1a2e]/80 backdrop-blur-xl border border-gray-200 dark:border-white/10 rounded-2xl shadow-lg"
  >
    <a
      href="#hero"
      class="dock-item flex items-center justify-center px-2 sm:px-3 py-1.5 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white transition-all cursor-pointer"
      data-section="hero"
      aria-label="Home"
    >
      <HomeIcon class="w-4 h-4 sm:hidden" />
      <span class="hidden sm:inline font-mono text-sm">~/</span>
    </a>

    <a
      href="#experience"
      class="dock-item flex items-center justify-center px-2 sm:px-3 py-1.5 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white transition-all cursor-pointer"
      data-section="experience"
      aria-label="Experience"
    >
      <BriefcaseIcon class="w-4 h-4 sm:hidden" />
      <span class="hidden sm:inline font-mono text-sm">exp</span>
    </a>

    <a
      href="#skills"
      class="dock-item flex items-center justify-center px-2 sm:px-3 py-1.5 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white transition-all cursor-pointer"
      data-section="skills"
      aria-label="Skills"
    >
      <CodeIcon class="w-4 h-4 sm:hidden" />
      <span class="hidden sm:inline font-mono text-sm">skills</span>
    </a>

    <div class="w-px h-4 bg-gray-300 dark:bg-gray-600 mx-0.5 sm:mx-1"></div>

    <button
      class="dock-item flex items-center justify-center px-2 sm:px-3 py-1.5 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white transition-all cursor-pointer"
      id="dockThemeMode"
      aria-label="Toggle theme"
    >
      <span id="dockThemeIconLight" class="sm:hidden">
        <SunIcon class="w-4 h-4" />
      </span>
      <span id="dockThemeIconDark" class="sm:hidden hidden">
        <MoonIcon class="w-4 h-4" />
      </span>
      <span class="hidden sm:inline font-mono text-sm" id="dockThemeModeText"
        >dark</span
      >
    </button>

    <button
      class="dock-item flex items-center justify-center px-2 sm:px-3 py-1.5 rounded-xl text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white transition-all cursor-pointer"
      id="dockLangMode"
      aria-label="Toggle language"
    >
      <span class="font-mono text-sm" id="dockLangModeText">es</span>
    </button>
  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dockItems = document.querySelectorAll(".dock-item[data-section]");
    const sections = ["hero", "experience", "skills"];

    const activeClasses = [
      "bg-[#50fa7b]/20",
      "!text-[#16a34a]",
      "dark:!text-[#50fa7b]",
    ];

    function updateActiveSection() {
      const scrollPosition = window.scrollY + window.innerHeight / 3;

      let currentSection = "hero";

      sections.forEach((sectionId) => {
        const section = document.getElementById(sectionId);
        if (section) {
          const sectionTop = section.offsetTop;
          if (scrollPosition >= sectionTop) {
            currentSection = sectionId;
          }
        }
      });

      dockItems.forEach((item) => {
        const itemSection = item.getAttribute("data-section");
        if (itemSection === currentSection) {
          activeClasses.forEach((cls) => item.classList.add(cls));
        } else {
          activeClasses.forEach((cls) => item.classList.remove(cls));
        }
      });
    }

    window.addEventListener("scroll", updateActiveSection);
    updateActiveSection();

    const dockThemeMode = document.getElementById("dockThemeMode");
    const dockThemeModeText = document.getElementById("dockThemeModeText");
    const dockThemeIconLight = document.getElementById("dockThemeIconLight");
    const dockThemeIconDark = document.getElementById("dockThemeIconDark");
    const dockLangMode = document.getElementById("dockLangMode");
    const dockLangModeText = document.getElementById("dockLangModeText");
    const html = document.documentElement;

    function syncDockTheme() {
      const isDark = html.classList.contains("dark");
      if (dockThemeModeText) {
        dockThemeModeText.innerText = isDark ? "light" : "dark";
      }
      if (dockThemeIconLight && dockThemeIconDark) {
        if (isDark) {
          dockThemeIconLight.classList.remove("hidden");
          dockThemeIconDark.classList.add("hidden");
        } else {
          dockThemeIconLight.classList.add("hidden");
          dockThemeIconDark.classList.remove("hidden");
        }
      }
    }

    function syncDockLang() {
      const lang = localStorage.getItem("portfolioLang") || "en";
      if (dockLangModeText) {
        dockLangModeText.innerText = lang === "en" ? "es" : "en";
      }
    }

    syncDockTheme();
    syncDockLang();

    const observer = new MutationObserver(() => {
      syncDockTheme();
    });
    observer.observe(html, { attributes: true, attributeFilter: ["class"] });

    window.addEventListener("storage", syncDockLang);

    if (dockThemeMode) {
      dockThemeMode.addEventListener("click", () => {
        const mainThemeBtn = document.getElementById("themeMode");
        if (mainThemeBtn) mainThemeBtn.click();
      });
    }

    if (dockLangMode) {
      dockLangMode.addEventListener("click", () => {
        const mainLangBtn = document.getElementById("langMode");
        if (mainLangBtn) mainLangBtn.click();
        setTimeout(syncDockLang, 50);
      });
    }
  });
</script>
